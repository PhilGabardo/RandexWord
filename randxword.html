
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="robots" content="noindex, nofollow">
<meta name="googlebot" content="noindex, nofollow">
<script type="text/javascript" src="dict2.js"></script> 
<script type="text/javascript" src="word2.js"></script> 
<script type='text/javascript' src=' http://code.jquery.com/jquery-1.11.0.js'></script>
<style type="text/css">
#puzzle {
	width:100%;
margin: 0;
padding: 10px;
border: 1px solid black;
}


.square{
width:30px;
height:30px;
margin: 0;
padding: 0;
	 border-collapse: collapse;
position: relative;
}


.empty{
	background-color:black;
border: 1px solid black;
}

.letter{
border: 1px solid black;
cursor: pointer;
	text-align: center;
	vertical-align: middle;
	line-height: 30px;
color: transparent;
       text-shadow: 0 0 0 gray;
       text-align: center;


       &:focus {
outline: none;
       }
}

.letter:hover{
border: 1px solid blue;
}

#puzzle_container{
float: left;
width:50%
	      height: 50%;
}

#hints_container{
float: left;
width:50%
	      height: 50%;
      margin-left: 25px;
}

#buttons_container{
clear: both;
       padding-top: 20px;
       margin-left: 50px;
}

.active{
}

.question_number{
position: absolute;
	  font-size: 12px;
color: grey;
left: 3px;
top: 3px;
}

td{
position:relative;
}
</style>
<title></title>
<script type='text/javascript'>

var clues = [];
var answers = [];
var grid =  [];
var charGrid = [];

for (var i = 0; i < 15; i++){
	var row = [];
	var charRow = [];
	for (var j = 0; j < 15; j++){
		row.push(0);
		charRow.push(0);
	}
	charGrid.push(charRow);
	grid.push(row);
}


function isHorizontal(){
	var myNum = Math.floor(Math.random() * 2);
	if (myNum == 0){
		return true;
	}
	else{
		return false;
	}
}

function getClue(dict, myWord){
	var clues = dict[myWord];
	return clues[Math.floor(Math.random() * clues.length)];
}


function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}


function findNextWord(grid, horizontal, wordLength, stack, wordFinder){

	var result = {word: undefined, x: undefined, y:undefined};
	if (stack.length == 0){
		return result;
	}
	var indices = stack.pop();
	var myX = indices[0];
	var myY = indices[1];
	var potentialWords = [];

	var newX;
	var newY;


	if (horizontal){
		// determine starting point randomly.
		newY = myY + Math.floor(Math.random() * wordLength);
		var xRange = myX;
		while (xRange > 0 && grid[xRange][newY] != -1){
			xRange -= 1;
		}
		newX = myX - Math.floor(Math.random() * xRange);
		
		potentialWords = wordFinder[myX - newX][grid[newX][newY]];
		potentialWords = shuffle(potentialWords);


	
	}
	else{
		// determine starting point randomly.
		newX = myX + Math.floor(Math.random() * wordLength);
		var yRange = myY;
		while (yRange > 0 && grid[newX][yRange] != -1){
			yRange -= 1;
		}
		newY = myY - Math.floor(Math.random() * yRange);
		
		potentialWords = wordFinder[myY - newY][grid[newX][newY]];
		potentialWords = shuffle(potentialWords);
	}

	for (var i = 0; i < potentialWords.length; i++){
		var newWord = potentialWords[i];

		var feasible = true;

		// Check if word works.
		if (horizontal){
			for (var j = 0; j < newWord.length; j++){
				if (newX + j >= grid.length){
					feasible = false;
				}
				else if (grid[newX + j][newY] == -1){
					feasible = false;
				}
				else if (grid[newX + j][newY] != 0 && grid[newX + j][newY] != newWord.charAt(j)){
					feasible = false;
				}
			}
		}
		else {
			for (var j = 0; j < newWord.length; j++){
				if (newY + j >= grid.length){
					feasible = false;
				}
				else if (grid[newX][newY + j] == -1){
					feasible = false;
				}
				else if (grid[newX][newY + j] != 0 && grid[newX][newY + j] != newWord.charAt(j)){
					feasible = false;
				}
			}


		}

		// If word words, return it!
		if (feasible) {
			result.word = newWord;
			result.x = newX;
			result.y = newY;
			return result;
		}
	}
	

	return findNextWord(grid, horizontal, wordLength, stack, wordFinder);



}



function generateCW(words, dict){
	var wordCount = 1;
	var found = true;
	var myX = 0;
	var myY = 0;
	var wordFinder = new Array();
	var locationStack = [];

	for (var i = 0; i < words.length; i++){
		var word = words[i];
		
		for (var j = 0; j < word.length; j++){
			if (!(j in wordFinder)){
				wordFinder[j] = {};
			}
			if (!(word.charAt(j) in wordFinder[j])){
				wordFinder[j][word.charAt(j)] = [];
			}
			wordFinder[j][word.charAt(j)].push(word);
		}
	}


	var horizontal = isHorizontal();
	var myWordIndex = Math.floor(Math.random() * words.length);
	var myWord = words[myWordIndex];
	var myClue = getClue(dict, myWord);

	while (found){
		answers.push(myWord);
		clues.push(myClue);
		locationStack.push([myX, myY]);
		if (horizontal){
			for (var i = 0; i < myWord.length; i++){
				if (grid[myX][myY + i] == 0){
					grid[myX][myY + i] = wordCount;
				}
				else{
					grid[myX][myY + i] = grid[myX][myY + i] + "," + wordCount
				}
				charGrid[myX][myY + i] = myWord.charAt(i);
			}

			// space out words

			if (myY > 0){
				charGrid[myX][myY - 1] = -1;
			}
			if (myY < myWord.length - 1){
				charGrid[myX][myY + myWord.length] = - 1;
			}


		}
		else {
			for (var i = 0; i < myWord.length; i++){
				if (grid[myX + i][myY] == 0) {
					grid[myX + i][myY] = wordCount;
				}
				else {
					grid[myX + i][myY] = grid[myX + i][myY] + "," + wordCount;
				}
				charGrid[myX + i][myY] = myWord.charAt(i);
			}


			// space out words

			if (myX > 0){
				charGrid[myX - 1][myY] = -1;
			}
			if (myX < myWord.length - 1){
				charGrid[myX + myWord.length][myY] = - 1;
			}



		}
		

		var update = findNextWord(charGrid, horizontal, myWord.length, locationStack, wordFinder);
		myWord = update.word;
		myX = update.x;
		myY = update.y;

		if (myWord == undefined || answers.length > 2){
			found = false;
		}
		else{
			myClue = getClue(dict, myWord);
		}

		horizontal = !horizontal;
		wordCount += 1;
	}	
	
}

$(window).load(function(){

/*
		var gridTest = [	[0,	0, 0, 0, '1', 0, 0, 0, 0, 0],
		[0, 0, 0, 0, '1', 0, 0, 0, 0, 0],
		[0, 0, 0, 0, '1', 0, '2', 0, 0, 0],
		[0, '3', '3', '3', '3,1', '3', '3,2', '3', '3', '3,4'],
		[0, 0, 0, 0, 0, 0, '2', 0, 0, '4'],
		[0, 0, 0, 0, 0, 0, '2', 0, 0, '4'],
		[0, 0, '5', '5', '5', '5', '2,5', '5', 0, '4'],
		[0, 0, 0, 0, 0, 0, '2', 0, 0, '4'],
		[0, 0, 0, 0, 0, 0, '2', 0, 0, 0],
		['6', '6', '6', '6', '6', '6', '2,6', 0, 0, 0],
		[0, 0, 0, 0, 0, 0, '2', 0, 0, 0]
		];
*/

		var constraintDict = {}
		
		generateCW(myWords, myDict);
/*
var clues = ["Education Hub",
    "Information Technology Hub",
    "Cultural Hub",
    "Capital of India",
    "India's financial capital",
    "Saffron region"
    ];

    var answers = ["pune",
    "bangalore",
    "hyderabad",
    "delhi",
    "mumbai",
    "kashmir"
    ];
*/

    //Draw grid

    $.each(grid,function(i){
		    var row = $('<tr></tr>');
		    $.each(this,function(j){
			    if(this == 0){
			    $(row).append('<td class="square empty"></td>');  
			    }
			    else{
			    var question_number = String(grid[i][j]).split(",");

			    var starting_number = '';
			    var question_number_span = '';

			    for(var k = 0;k < question_number.length;k++){
			    var direction = get_direction(question_number[k]);
			    var startpos = get_startpos(question_number[k],direction);

			    if(direction == "horizontal" && startpos[0] == i && startpos[1] == j){
			    starting_number += question_number[k]+",";

			    }
			    else if(direction == "vertical" && startpos[0] == j && startpos[1] == i){
			    starting_number += question_number[k]+",";
			    }              

			    }
			    if(starting_number != ""){
				    question_number_span = '<span class="question_number">'+starting_number.replace(/(^,)|(,$)/g, "")+'</span>';   
			    }

			    $(row).append('<td>'+question_number_span+'<div class="square letter" data-number="'+this+'" contenteditable="true"></div></td>'); 
			    }
		    });
		    $("#puzzle").append(row);
    });

//Draw hints
var vertical_hints = $('<div id="vertical_hints"></div>');
var horizontal_hints = $('<div id="horizontal_hints"></div>');
$.each(clues,function(index){

		var direction = get_direction(index+1);

		if(direction == "horizontal"){
		$(horizontal_hints).append('<div class="hint"><b>'+(index+1)+'</b>.-'+clues[index]+'</hint>');
		}
		else if(direction == "vertical"){
		$(vertical_hints).append('<div class="hint"><b>'+(index+1)+'</b>.-'+clues[index]+'</hint>');
		}
		});
$("#vertical_hints_container").append(vertical_hints);
$("#horizontal_hints_container").append(horizontal_hints);

$(".letter").keyup(function(){
		var this_text = $(this).text();
		if(this_text.length > 1){
		$(this).text(this_text.slice(0,1));
		}
		});

$(".letter").click(function(){
		document.execCommand('selectAll',false,null);

		$(".letter").removeClass("active");
		$(this).addClass("active");

		$(".hint").css("text-shadow","0 0 0 initial");

		var question_numbers = String($(this).data("number")).split(",");

		$.each(question_numbers,function(){
			$("#hints .hint:nth-child("+this+")").css("text-shadow","0 0 0 red");
			});
		});

$("#solve").click(function(){
		if(!$(".letter.active").length)
		return;
		var question_numbers = String($(".letter.active").data("number")).split(",");
		$.each(question_numbers,function(){
			fillAnswer(this);
			});
		});

$("#clear_all").click(function(){
		if(!$(".letter.active").length)
		return;
		var question_numbers = String($(".letter.active").data("number")).split(",");
		$.each(question_numbers,function(){
			clearAnswer(this);
			});
		});

$("#check").click(function(){
		$("#puzzle td div").css("text-shadow","0 0 0 initial");
		for(var i = 0;i < answers.length;i++){
		checkAnswer(i+1);
		}    
		});

$("#clue").click(function(){
		if(!$(".letter.active").length)
		return;
		var question_numbers = String($(".letter.active").data("number")).split(",");
		showClue(question_numbers[0],$(".letter.active").parent().index(),$(".letter.active").parent().parent().index());
		});

function get_direction(question_number){
	for(var i=0;i < grid.length;i++){
		for(var j=0;j < grid[i].length;j++){
			if(String(grid[i][j]).indexOf(question_number) != -1){            
				if(((i < grid.length - 1) && grid[i+1][j] == question_number) || ((i > 0) && grid[i-1][j] == question_number)){
					return "vertical";
				}

				if(((j < grid[i].length - 1) && grid[i][j+1] == question_number) || ((j > 0) && grid[i][j-1] == question_number)){
					return "horizontal";
				}
			}
		}
	}
}

function get_startpos(question_number,direction){
	if(direction == "horizontal"){
		for(var i=0;i < grid.length;i++){
			for(var j=0;j < grid[i].length;j++){
				if(String(grid[i][j]).indexOf(question_number) != -1){            
					return [i,j];
				}
			}
		}
	}

	else if(direction == "vertical"){
		for(var i=0;i < grid.length;i++){
			for(var j=0;j < grid[i].length;j++){
				if(String(grid[j][i]).indexOf(question_number) != -1){            
					return [i,j];
				}
			}
		}
	}
}

function fillAnswer(question_number){
	$("#puzzle td div").css("text-shadow","0 0 0 initial");

	var question_answer = answers[question_number-1];
	var direction = get_direction(question_number);
	var startpos = get_startpos(question_number,direction);
	var answer_letters = question_answer.split("");

	if(direction == "horizontal"){
		for(var i = 0; i < answer_letters.length; i++){
			$("#puzzle tr:nth-child("+(startpos[0]+1)+") td:nth-child("+(startpos[1]+1+i)+") div").text(answer_letters[i]);
		}

	}
	else if(direction == "vertical"){
		for(var i = 0; i < answer_letters.length; i++){
			$("#puzzle tr:nth-child("+(startpos[1]+1+i)+") td:nth-child("+(startpos[0]+1)+") div").text(answer_letters[i]);
		}

	}
}

function clearAnswer(question_number){
	$("#puzzle td div").css("text-shadow","0 0 0 initial");

	var question_answer = answers[question_number-1];
	var direction = get_direction(question_number);
	var startpos = get_startpos(question_number,direction);
	var answer_letters = question_answer.split("");

	if(direction == "horizontal"){
		for(var i = 0; i < answer_letters.length; i++){
			$("#puzzle tr:nth-child("+(startpos[0]+1)+") td:nth-child("+(startpos[1]+1+i)+") div").text('');
		}

	}
	else if(direction == "vertical"){
		for(var i = 0; i < answer_letters.length; i++){
			$("#puzzle tr:nth-child("+(startpos[1]+1+i)+") td:nth-child("+(startpos[0]+1)+") div").text('');
		}

	}
}

function checkAnswer(question_number){
	var question_answer = answers[question_number-1];
	var direction = get_direction(question_number);
	var startpos = get_startpos(question_number,direction);
	var answer_letters = question_answer.split("");

	if(direction == "horizontal"){
		for(var i = 0; i < answer_letters.length; i++){
			if($("#puzzle tr:nth-child("+(startpos[0]+1)+") td:nth-child("+(startpos[1]+1+i)+") div").text() != question_answer[i] && $("#puzzle tr:nth-child("+(startpos[0]+1)+") td:nth-child("+(startpos[1]+1+i)+") div").text() != ""){
				$("#puzzle tr:nth-child("+(startpos[0]+1)+") td:nth-child("+(startpos[1]+1+i)+") div").css("text-shadow","0 0 0 red");
			}
		}

	}
	else if(direction == "vertical"){
		for(var i = 0; i < answer_letters.length; i++){
			if($("#puzzle tr:nth-child("+(startpos[1]+1+i)+") td:nth-child("+(startpos[0]+1)+") div").text() != question_answer[i] && $("#puzzle tr:nth-child("+(startpos[1]+1+i)+") td:nth-child("+(startpos[0]+1)+") div").text() != ""){
				$("#puzzle tr:nth-child("+(startpos[1]+1+i)+") td:nth-child("+(startpos[0]+1)+") div").css("text-shadow","0 0 0 red");
			}
		}

	}
}

function showClue(question_number,i,j){
	var question_answer = answers[question_number-1];
	var direction = get_direction(question_number);
	var startpos = get_startpos(question_number,direction);
	var answer_letters = question_answer.split("");

	if(direction == "horizontal"){
		$("#puzzle tr:nth-child("+(j+1)+") td:nth-child("+(i+1)+") div").text(answer_letters[i - startpos[1]]).css("text-shadow","0 0 0 initial");
	}
	else if(direction == "vertical"){
		$("#puzzle tr:nth-child("+(j+1)+") td:nth-child("+(i+1)+") div").text(answer_letters[j - startpos[1]]).css("text-shadow","0 0 0 initial");
	}
}

}); 
</script>


</head>

<body>
<div id="puzzle_container">
<table id="puzzle">
</table>
</div>

<div id="hints_container">
<h3>Vertical</h3>
<div id="vertical_hints_container"></div>
<h3>Horizontal</h3>
<div id="horizontal_hints_container"></div>
</div>

<div id="buttons_container">
<button id="clear_all">Clear All</button>
<button id="check">Check</button>
<button id="solve">Solve</button>
<button id="clue">Clue</button>
</div>


</body>

</html>


